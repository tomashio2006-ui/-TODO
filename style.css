const taskInput = document.getElementById("taskInput");
const setInput = document.getElementById("setInput");
const addBtn = document.getElementById("addBtn");
const suggestBtn = document.getElementById("suggestBtn");
const list = document.getElementById("taskList");

const workoutSuggestions = [
  "腕立て伏せ 20回",
  "スクワット 30回",
  "腹筋 20回",
  "プランク 60秒",
  "ランジ 20回",
  "もも上げ 50回",
  "ジャンピングジャック 30回"
];

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

function save() {
  localStorage.setItem("tasks", JSON.stringify(tasks));
}

suggestBtn.addEventListener("click", () => {
  const random =
    workoutSuggestions[Math.floor(Math.random() * workoutSuggestions.length)];
  taskInput.value = random;
});

function render() {
  list.innerHTML = "";

  tasks.forEach((task, index) => {
    const li = document.createElement("li");

    const title = document.createElement("strong");
    title.textContent = `${task.text}（${task.sets.length}セット）`;
    li.appendChild(title);

    const setsDiv = document.createElement("div");
    setsDiv.className = "sets";

    task.sets.forEach((done, i) => {
      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = done;

      checkbox.addEventListener("change", () => {
        task.sets[i] = checkbox.checked;
        task.done = task.sets.every(s => s);
        save();
        render();
      });

      label.appendChild(checkbox);
      label.append(` セット ${i + 1}`);
      setsDiv.appendChild(label);
    });

    if (task.done) li.classList.add("done");

    const delBtn = document.createElement("button");
    delBtn.textContent = "削除";
    delBtn.className = "delete";
    delBtn.addEventListener("click", () => {
      tasks.splice(index, 1);
      save();
      render();
    });

    li.appendChild(setsDiv);
    li.appendChild(delBtn);
    list.appendChild(li);
  });
}

addBtn.addEventListener("click", () => {
  const text = taskInput.value;
  const setCount = Number(setInput.value);

  if (!text || setCount < 1) return;

  tasks.push({
    text,
    sets: Array(setCount).fill(false),
    done: false
  });

  taskInput.value = "";
  setInput.value = "";
  save();
  render();
});

render();
